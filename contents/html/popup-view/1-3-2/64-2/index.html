<!DOCTYPE html>
<html lang="ko">

<head>
	<!--메타 데이타-->
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<!--COMMON CSS-->
	<link rel="stylesheet" type="text/css" href="../../../../com/css/module.reset.css" />
	<link rel="stylesheet" type="text/css" href="../../../../com/css/module.ui.css" />
	<link rel="stylesheet" type="text/css" href="../../../../com/css/module.media.css" />
	<link rel="stylesheet" type="text/css" href="../../../../com/css/module.quiz.css" />
	<!--COMMON JS-->
	<script type="text/javascript" src="../../../../com/js/module.exe.js"></script>
	<script type="text/javascript" src="../../../../com/js/module.util.js"></script>
	<script type="text/javascript" src="../../../../com/js/module.fn.js"></script>
	<script type="text/javascript" src="../../../../com/js/module.media.js"></script>
	<script type="text/javascript" src="../../../../com/js/module.quiz.js"></script>
	<!-- VIEW SRC-->
	<link rel="stylesheet" type="text/css" href="../../[src]/css/popup.skill.css" />
	<link rel="stylesheet" type="text/css" href="../../[src]/css/popup.view.css" />
	<link rel="stylesheet" type="text/css" href="../../[src]/css/screen.css" />
	<script type="text/javascript" src="../../[src]/js/popup.skill.js"></script>
	<script type="text/javascript" src="../../[src]/js/popup.view.js"></script>
	<!-- VIEW -->
	<script type="text/javascript" src="../../[src]/js/jquery-1.12.4.min.js"></script>
	<!--link rel="stylesheet" type="text/css" href="index.css" />
    <script type="text/javascript" src="index.js" ></script-->
	<style>
		#imgArea {
			position: relative;
			width: 1720px;
			height: 794px;
			user-select: none;
		}

		#imgArea img {
			width: 100%;
			height: 100%;
			display: block;
		}

		#drawingSvg {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1;
		}

		#drawingSvg path {
			stroke:transparent;
			stroke-width: 8;
			stroke-linecap: round;
			stroke-linejoin: round;
			fill: none;
			opacity: 0.6;
		}

		#answerArea,
		#answerArea2,
		#answerArea3 {
			display: none;
		}
	</style>
</head>

<body>
	<main id="popup-view" class="s">
		<header data-ui="mb:15">
			<!--주제-->
			<h1 data-subject="중단원 마무리 정리하기"><span>중단원 마무리 정리하기</span></h1>
			<!--질문-->
			<h2 data-question="중단원"><span>●</span>
				<span>다음 글자 상자에 숨은 문장들을 찾아보고, 그 문장이 나에게 주는 의미를 생각해 보자. (
					<span data-ui="w:112 h:49 BG:res/힌트.png mt:5 mr:5" style="display: inline-block"> </span> 힌트 3개)</span>
			</h2>
		</header>
		<section data-design="중단원 마무리 정리하기">


			<div data-ui="w:1720 h:794 P:r" id="imgArea">
				<img src="res/bg.png" alt="">

				<svg id="drawingSvg" xmlns="http://www.w3.org/2000/svg"></svg>

				<p id="answerArea" data-ui="P:a l:20 t:20">
					<svg xmlns="http://www.w3.org/2000/svg" width="1596" height="742" viewBox="0 0 1596 742" fill="none">
						<path
							d="M1561.56 635.238C1589.65 647.165 1602.77 679.619 1590.84 707.715C1578.92 735.822 1546.46 748.929 1518.36 737.002L34.5179 107.147C6.42209 95.2198 -6.69568 62.7656 5.23149 34.6698C17.1587 6.57393 49.6129 -6.54382 77.7087 5.38335L1561.56 635.238Z"
							fill="#CAE8FA" fill-opacity="0.8" />
					</svg>
				</p>
				<p id="answerArea3" data-ui="P:a l:700 t:40">
					<svg xmlns="http://www.w3.org/2000/svg" width="111" height="715" viewBox="0 0 111 715" fill="none">
						<path
							d="M0.428223 659.095C0.428223 689.625 25.1755 714.373 55.7057 714.373C86.2358 714.373 110.983 689.625 110.983 659.095V56.0821C110.983 25.552 86.2358 0.804688 55.7057 0.804688C25.1755 0.804688 0.428223 25.552 0.428223 56.0821V659.095Z"
							fill="#D0D1FE" fill-opacity="0.8" />
					</svg>
				</p>
				<p id="answerArea2" data-ui="P:a l:60 t:20">
					<svg xmlns="http://www.w3.org/2000/svg" width="1596" height="741" viewBox="0 0 1596 741" fill="none">
						<path
							d="M34.4012 634.326C6.30539 646.253 -6.81238 678.707 5.11479 706.803C17.042 734.909 49.4962 748.017 77.592 736.089L1561.43 106.235C1589.53 94.3077 1602.64 61.8535 1590.72 33.7577C1578.79 5.66185 1546.33 -7.45593 1518.24 4.47124L34.4012 634.326Z"
							fill="#F4D1E8" fill-opacity="0.8" />
					</svg>
				</p>
			</div>


			<script>
				$(function () {
					const $svg = $('#drawingSvg');
					const svg = $svg[0];

					let isDrawing = false;
					let currentPath = null;
					let pathData = '';

					// 좌표 변환
					function getRelativeCoords(evt) {
						const rect = svg.getBoundingClientRect();
						return {
							x: evt.clientX - rect.left,
							y: evt.clientY - rect.top
						};
					}

					// 정답 영역 좌표 (id, left, top, width, height)
					const answerAreas = [
						{ id: '#answerArea', left: 20, top: 20, width: 800, height: 100 },
						{ id: '#answerArea2', left: 60, top: 20, width: 800, height: 100 },
						{ id: '#answerArea3', left: 700, top: 40, width: 111, height: 715 }
					];

					// 충돌 체크
					function isOverlap(rect1, rect2) {
						return !(
							rect1.left > rect2.left + rect2.width ||
							rect1.left + rect1.width < rect2.left ||
							rect1.top > rect2.top + rect2.height ||
							rect1.top + rect1.height < rect2.top
						);
					}

					let dragStart = null;

					$('#imgArea').on('mousedown', function (e) {
						isDrawing = true;

						const { x, y } = getRelativeCoords(e.originalEvent);
						pathData = `M ${x} ${y}`;

						currentPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
						currentPath.setAttribute("d", pathData);
						currentPath.setAttribute("stroke", "#ffea00");
						currentPath.setAttribute("stroke-width", "8");
						currentPath.setAttribute("stroke-linecap", "round");
						currentPath.setAttribute("stroke-linejoin", "round");
						currentPath.setAttribute("fill", "none");
						currentPath.setAttribute("opacity", "0.6");
						svg.appendChild(currentPath);

						dragStart = { x: e.offsetX, y: e.offsetY };
					});

					$('#imgArea').on('mousemove', function (e) {
						if (!isDrawing) return;
						const { x, y } = getRelativeCoords(e.originalEvent);
						pathData += ` L ${x} ${y}`;
						currentPath.setAttribute("d", pathData);
					});

					$(document).on('mouseup', function (e) {
						if (!isDrawing) return;
						isDrawing = false;
						currentPath = null;
						pathData = '';

						const dragEnd = { x: e.offsetX, y: e.offsetY };

						const dragRect = {
							left: Math.min(dragStart.x, dragEnd.x),
							top: Math.min(dragStart.y, dragEnd.y),
							width: Math.abs(dragStart.x - dragEnd.x),
							height: Math.abs(dragStart.y - dragEnd.y)
						};

						let matched = false;

						answerAreas.forEach(area => {
							if (!matched && isOverlap(dragRect, area)) {
								// 처음 겹친 영역만 표시
								$(area.id).show();
								matched = true;
							} else {
								$(area.id).hide();
							}
						});
					});
				});

			</script>
		</section>
	</main>
</body>

</html>